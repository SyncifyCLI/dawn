{
  "version": 3,
  "sources": ["../../source/assets/scripts/predictive-search.js"],
  "sourcesContent": ["class PredictiveSearch extends SearchForm {\n  constructor() {\n    super();\n    this.cachedResults = {};\n    this.predictiveSearchResults = this.querySelector('[data-predictive-search]');\n    this.allPredictiveSearchInstances = document.querySelectorAll('predictive-search');\n    this.isOpen = false;\n    this.abortController = new AbortController();\n    this.searchTerm = '';\n\n    this.setupEventListeners();\n  }\n\n  setupEventListeners() {\n    this.input.form.addEventListener('submit', this.onFormSubmit.bind(this));\n\n    this.input.addEventListener('focus', this.onFocus.bind(this));\n    this.addEventListener('focusout', this.onFocusOut.bind(this));\n    this.addEventListener('keyup', this.onKeyup.bind(this));\n    this.addEventListener('keydown', this.onKeydown.bind(this));\n  }\n\n  getQuery() {\n    return this.input.value.trim();\n  }\n\n  onChange() {\n    super.onChange();\n    const newSearchTerm = this.getQuery();\n    if (!this.searchTerm || !newSearchTerm.startsWith(this.searchTerm)) {\n      // Remove the results when they are no longer relevant for the new search term\n      // so they don't show up when the dropdown opens again\n      this.querySelector('#predictive-search-results-groups-wrapper')?.remove();\n    }\n\n    // Update the term asap, don't wait for the predictive search query to finish loading\n    this.updateSearchForTerm(this.searchTerm, newSearchTerm);\n\n    this.searchTerm = newSearchTerm;\n\n    if (!this.searchTerm.length) {\n      this.close(true);\n      return;\n    }\n\n    this.getSearchResults(this.searchTerm);\n  }\n\n  onFormSubmit(event) {\n    if (!this.getQuery().length || this.querySelector('[aria-selected=\"true\"] a')) event.preventDefault();\n  }\n\n  onFormReset(event) {\n    super.onFormReset(event);\n    if (super.shouldResetForm()) {\n      this.searchTerm = '';\n      this.abortController.abort();\n      this.abortController = new AbortController();\n      this.closeResults(true);\n    }\n  }\n\n  onFocus() {\n    const currentSearchTerm = this.getQuery();\n\n    if (!currentSearchTerm.length) return;\n\n    if (this.searchTerm !== currentSearchTerm) {\n      // Search term was changed from other search input, treat it as a user change\n      this.onChange();\n    } else if (this.getAttribute('results') === 'true') {\n      this.open();\n    } else {\n      this.getSearchResults(this.searchTerm);\n    }\n  }\n\n  onFocusOut() {\n    setTimeout(() => {\n      if (!this.contains(document.activeElement)) this.close();\n    });\n  }\n\n  onKeyup(event) {\n    if (!this.getQuery().length) this.close(true);\n    event.preventDefault();\n\n    switch (event.code) {\n      case 'ArrowUp':\n        this.switchOption('up');\n        break;\n      case 'ArrowDown':\n        this.switchOption('down');\n        break;\n      case 'Enter':\n        this.selectOption();\n        break;\n    }\n  }\n\n  onKeydown(event) {\n    // Prevent the cursor from moving in the input when using the up and down arrow keys\n    if (event.code === 'ArrowUp' || event.code === 'ArrowDown') {\n      event.preventDefault();\n    }\n  }\n\n  updateSearchForTerm(previousTerm, newTerm) {\n    const searchForTextElement = this.querySelector('[data-predictive-search-search-for-text]');\n    const currentButtonText = searchForTextElement?.innerText;\n    if (currentButtonText) {\n      if (currentButtonText.match(new RegExp(previousTerm, 'g')).length > 1) {\n        // The new term matches part of the button text and not just the search term, do not replace to avoid mistakes\n        return;\n      }\n      const newButtonText = currentButtonText.replace(previousTerm, newTerm);\n      searchForTextElement.innerText = newButtonText;\n    }\n  }\n\n  switchOption(direction) {\n    if (!this.getAttribute('open')) return;\n\n    const moveUp = direction === 'up';\n    const selectedElement = this.querySelector('[aria-selected=\"true\"]');\n\n    // Filter out hidden elements (duplicated page and article resources) thanks\n    // to this https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetParent\n    const allVisibleElements = Array.from(this.querySelectorAll('li, button.predictive-search__item')).filter(\n      (element) => element.offsetParent !== null\n    );\n    let activeElementIndex = 0;\n\n    if (moveUp && !selectedElement) return;\n\n    let selectedElementIndex = -1;\n    let i = 0;\n\n    while (selectedElementIndex === -1 && i <= allVisibleElements.length) {\n      if (allVisibleElements[i] === selectedElement) {\n        selectedElementIndex = i;\n      }\n      i++;\n    }\n\n    this.statusElement.textContent = '';\n\n    if (!moveUp && selectedElement) {\n      activeElementIndex = selectedElementIndex === allVisibleElements.length - 1 ? 0 : selectedElementIndex + 1;\n    } else if (moveUp) {\n      activeElementIndex = selectedElementIndex === 0 ? allVisibleElements.length - 1 : selectedElementIndex - 1;\n    }\n\n    if (activeElementIndex === selectedElementIndex) return;\n\n    const activeElement = allVisibleElements[activeElementIndex];\n\n    activeElement.setAttribute('aria-selected', true);\n    if (selectedElement) selectedElement.setAttribute('aria-selected', false);\n\n    this.input.setAttribute('aria-activedescendant', activeElement.id);\n  }\n\n  selectOption() {\n    const selectedOption = this.querySelector('[aria-selected=\"true\"] a, button[aria-selected=\"true\"]');\n\n    if (selectedOption) selectedOption.click();\n  }\n\n  getSearchResults(searchTerm) {\n    const queryKey = searchTerm.replace(' ', '-').toLowerCase();\n    this.setLiveRegionLoadingState();\n\n    if (this.cachedResults[queryKey]) {\n      this.renderSearchResults(this.cachedResults[queryKey]);\n      return;\n    }\n\n    fetch(`${routes.predictive_search_url}?q=${encodeURIComponent(searchTerm)}&section_id=predictive-search`, {\n      signal: this.abortController.signal,\n    })\n      .then((response) => {\n        if (!response.ok) {\n          var error = new Error(response.status);\n          this.close();\n          throw error;\n        }\n\n        return response.text();\n      })\n      .then((text) => {\n        const resultsMarkup = new DOMParser()\n          .parseFromString(text, 'text/html')\n          .querySelector('#shopify-section-predictive-search').innerHTML;\n        // Save bandwidth keeping the cache in all instances synced\n        this.allPredictiveSearchInstances.forEach((predictiveSearchInstance) => {\n          predictiveSearchInstance.cachedResults[queryKey] = resultsMarkup;\n        });\n        this.renderSearchResults(resultsMarkup);\n      })\n      .catch((error) => {\n        if (error?.code === 20) {\n          // Code 20 means the call was aborted\n          return;\n        }\n        this.close();\n        throw error;\n      });\n  }\n\n  setLiveRegionLoadingState() {\n    this.statusElement = this.statusElement || this.querySelector('.predictive-search-status');\n    this.loadingText = this.loadingText || this.getAttribute('data-loading-text');\n\n    this.setLiveRegionText(this.loadingText);\n    this.setAttribute('loading', true);\n  }\n\n  setLiveRegionText(statusText) {\n    this.statusElement.setAttribute('aria-hidden', 'false');\n    this.statusElement.textContent = statusText;\n\n    setTimeout(() => {\n      this.statusElement.setAttribute('aria-hidden', 'true');\n    }, 1000);\n  }\n\n  renderSearchResults(resultsMarkup) {\n    this.predictiveSearchResults.innerHTML = resultsMarkup;\n    this.setAttribute('results', true);\n\n    this.setLiveRegionResults();\n    this.open();\n  }\n\n  setLiveRegionResults() {\n    this.removeAttribute('loading');\n    this.setLiveRegionText(this.querySelector('[data-predictive-search-live-region-count-value]').textContent);\n  }\n\n  getResultsMaxHeight() {\n    this.resultsMaxHeight =\n      window.innerHeight - document.querySelector('.section-header')?.getBoundingClientRect().bottom;\n    return this.resultsMaxHeight;\n  }\n\n  open() {\n    this.predictiveSearchResults.style.maxHeight = this.resultsMaxHeight || `${this.getResultsMaxHeight()}px`;\n    this.setAttribute('open', true);\n    this.input.setAttribute('aria-expanded', true);\n    this.isOpen = true;\n  }\n\n  close(clearSearchTerm = false) {\n    this.closeResults(clearSearchTerm);\n    this.isOpen = false;\n  }\n\n  closeResults(clearSearchTerm = false) {\n    if (clearSearchTerm) {\n      this.input.value = '';\n      this.removeAttribute('results');\n    }\n    const selected = this.querySelector('[aria-selected=\"true\"]');\n\n    if (selected) selected.setAttribute('aria-selected', false);\n\n    this.input.setAttribute('aria-activedescendant', '');\n    this.removeAttribute('loading');\n    this.removeAttribute('open');\n    this.input.setAttribute('aria-expanded', false);\n    this.resultsMaxHeight = false;\n    this.predictiveSearchResults.removeAttribute('style');\n  }\n}\n\ncustomElements.define('predictive-search', PredictiveSearch);\n"],
  "mappings": "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",
  "names": ["PredictiveSearch", "_a", "newSearchTerm", "event", "currentSearchTerm", "previousTerm", "newTerm", "searchForTextElement", "currentButtonText", "newButtonText", "direction", "moveUp", "selectedElement", "allVisibleElements", "element", "activeElementIndex", "selectedElementIndex", "i", "activeElement", "selectedOption", "searchTerm", "queryKey", "response", "error", "text", "resultsMarkup", "predictiveSearchInstance", "statusText", "clearSearchTerm", "selected"]
}
