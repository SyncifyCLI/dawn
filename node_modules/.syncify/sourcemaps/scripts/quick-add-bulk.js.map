{
  "version": 3,
  "sources": ["../../source/assets/scripts/quick-add-bulk.js"],
  "sourcesContent": ["if (!customElements.get('quick-add-bulk')) {\n  customElements.define(\n    'quick-add-bulk',\n    class QuickAddBulk extends BulkAdd {\n      constructor() {\n        super();\n        this.quantity = this.querySelector('quantity-input');\n\n        const debouncedOnChange = debounce((event) => {\n          if (parseInt(event.target.value) === 0) {\n            this.startQueue(event.target.dataset.index, parseInt(event.target.value));\n          } else {\n            this.validateQuantity(event);\n          }\n        }, ON_CHANGE_DEBOUNCE_TIMER);\n\n        this.addEventListener('change', debouncedOnChange.bind(this));\n        this.listenForActiveInput();\n        this.listenForKeydown();\n        this.lastActiveInputId = null;\n        const pageParams = new URLSearchParams(window.location.search);\n        window.pageNumber = decodeURIComponent(pageParams.get('page') || '');\n      }\n\n      connectedCallback() {\n        this.cartUpdateUnsubscriber = subscribe(PUB_SUB_EVENTS.cartUpdate, (event) => {\n          if (\n            event.source === 'quick-add' ||\n            (event.cartData.items && !event.cartData.items.some((item) => item.id === parseInt(this.dataset.index))) ||\n            (event.cartData.variant_id && !(event.cartData.variant_id === parseInt(this.dataset.index)))\n          ) {\n            return;\n          }\n          // If its another section that made the update\n          this.onCartUpdate().then(() => {\n            this.listenForActiveInput();\n            this.listenForKeydown();\n          });\n        });\n      }\n\n      disconnectedCallback() {\n        if (this.cartUpdateUnsubscriber) {\n          this.cartUpdateUnsubscriber();\n        }\n      }\n\n      getInput() {\n        return this.querySelector('quantity-input input');\n      }\n\n      selectProgressBar() {\n        return this.querySelector('.progress-bar-container');\n      }\n\n      listenForActiveInput() {\n        if (!this.classList.contains('hidden')) {\n          this.getInput().addEventListener('focusin', (event) => event.target.select());\n        }\n        this.isEnterPressed = false;\n      }\n\n      listenForKeydown() {\n        this.getInput().addEventListener('keydown', (event) => {\n          if (event.key === 'Enter') {\n            this.getInput().blur();\n            this.isEnterPressed = true;\n          }\n        });\n      }\n\n      cleanErrorMessageOnType(event) {\n        event.target.addEventListener(\n          'keypress',\n          () => {\n            event.target.setCustomValidity('');\n          },\n          { once: true }\n        );\n      }\n\n      onCartUpdate() {\n        return new Promise((resolve, reject) => {\n          fetch(`${this.getSectionsUrl()}?section_id=${this.closest('.collection').dataset.id}`)\n            .then((response) => response.text())\n            .then((responseText) => {\n              const html = new DOMParser().parseFromString(responseText, 'text/html');\n              const sourceQty = html.querySelector(\n                `#quick-add-bulk-${this.dataset.id}-${this.closest('.collection').dataset.id}`\n              );\n              if (sourceQty) {\n                this.innerHTML = sourceQty.innerHTML;\n              }\n              resolve();\n            })\n            .catch((e) => {\n              console.error(e);\n              reject(e);\n            });\n        });\n      }\n\n      updateMultipleQty(items) {\n        this.selectProgressBar().classList.remove('hidden');\n\n        const ids = Object.keys(items);\n        const body = JSON.stringify({\n          updates: items,\n          sections: this.getSectionsToRender().map((section) => section.section),\n          sections_url: this.getSectionsUrl(),\n        });\n\n        fetch(`${routes.cart_update_url}`, { ...fetchConfig(), ...{ body } })\n          .then((response) => {\n            return response.text();\n          })\n          .then((state) => {\n            const parsedState = JSON.parse(state);\n            this.renderSections(parsedState, ids);\n            publish(PUB_SUB_EVENTS.cartUpdate, { source: 'quick-add', cartData: parsedState });\n          })\n          .catch(() => {\n            // Commented out for now and will be fixed when BE issue is done https://github.com/Shopify/shopify/issues/440605\n            // e.target.setCustomValidity(error);\n            // e.target.reportValidity();\n            // this.resetQuantityInput(ids[index]);\n            // this.selectProgressBar().classList.add('hidden');\n            // e.target.select();\n            // this.cleanErrorMessageOnType(e);\n          })\n          .finally(() => {\n            this.selectProgressBar().classList.add('hidden');\n            this.requestStarted = false;\n          });\n      }\n\n      getSectionsToRender() {\n        return [\n          {\n            id: `quick-add-bulk-${this.dataset.id}-${this.closest('.collection-quick-add-bulk').dataset.id}`,\n            section: this.closest('.collection-quick-add-bulk').dataset.id,\n            selector: `#quick-add-bulk-${this.dataset.id}-${this.closest('.collection-quick-add-bulk').dataset.id}`,\n          },\n          {\n            id: 'cart-icon-bubble',\n            section: 'cart-icon-bubble',\n            selector: '.shopify-section',\n          },\n          {\n            id: 'CartDrawer',\n            selector: '#CartDrawer',\n            section: 'cart-drawer',\n          },\n        ];\n      }\n\n      renderSections(parsedState, ids) {\n        const intersection = this.queue.filter((element) => ids.includes(element.id));\n        if (intersection.length !== 0) return;\n        this.getSectionsToRender().forEach((section) => {\n          const sectionElement = document.getElementById(section.id);\n          if (\n            sectionElement &&\n            sectionElement.parentElement &&\n            sectionElement.parentElement.classList.contains('drawer')\n          ) {\n            parsedState.items.length > 0\n              ? sectionElement.parentElement.classList.remove('is-empty')\n              : sectionElement.parentElement.classList.add('is-empty');\n\n            setTimeout(() => {\n              document.querySelector('#CartDrawer-Overlay').addEventListener('click', this.cart.close.bind(this.cart));\n            });\n          }\n          const elementToReplace =\n            sectionElement && sectionElement.querySelector(section.selector)\n              ? sectionElement.querySelector(section.selector)\n              : sectionElement;\n          if (elementToReplace) {\n            elementToReplace.innerHTML = this.getSectionInnerHTML(\n              parsedState.sections[section.section],\n              section.selector\n            );\n          }\n        });\n\n        if (this.isEnterPressed) {\n          this.querySelector(`#Quantity-${this.lastActiveInputId}`).select();\n        }\n\n        this.listenForActiveInput();\n        this.listenForKeydown();\n      }\n    }\n  );\n}\n"],
  "mappings": "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",
  "names": ["debouncedOnChange", "event", "pageParams", "item", "resolve", "reject", "response", "responseText", "sourceQty", "e", "items", "ids", "body", "section", "__spreadProps", "__spreadValues", "state", "parsedState", "element", "sectionElement", "elementToReplace"]
}
